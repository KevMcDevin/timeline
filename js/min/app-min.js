var APP={Player:function(){function e(e,t){for(var n=0,o=e.length;o>n;n++)e[n](t)}function t(n){y=requestAnimationFrame(t),h.position.z=-25;try{e(g.update,{time:n,delta:n-L})}catch(o){console.error(o.message||o,o.stack||"")}w===!0?(h.updateMatrixWorld(),E.update(),l.render(v,f)):p.render(v,h),L=n}function n(t){e(g.keydown,t)}function o(t){e(g.keyup,t)}function i(t){e(g.mousedown,t)}function r(t){e(g.mouseup,t)}function s(t){e(g.mousemove,t)}function a(t){e(g.touchstart,t)}function d(t){e(g.touchend,t)}function u(t){e(g.touchmove,t)}var c=this,m=new THREE.ObjectLoader,h,v,p,E,l,f,w,g={};this.dom=document.createElement("div"),this.width=500,this.height=500,this.load=function(t){w=t.project.vr,p=new THREE.WebGLRenderer({antialias:!0}),p.setClearColor(0),p.setPixelRatio(window.devicePixelRatio),t.project.gammaInput&&(p.gammaInput=!0),t.project.gammaOutput&&(p.gammaOutput=!0),t.project.shadows&&(p.shadowMap.enabled=!0),this.dom.appendChild(p.domElement),this.setScene(m.parse(t.scene)),this.setCamera(m.parse(t.camera)),g={init:[],start:[],stop:[],keydown:[],keyup:[],mousedown:[],mouseup:[],mousemove:[],touchstart:[],touchend:[],touchmove:[],update:[]};var n="player,renderer,scene,camera",o={};for(var i in g)n+=","+i,o[i]=i;var r=JSON.stringify(o).replace(/\"/g,"");for(var s in t.scripts){var a=v.getObjectByProperty("uuid",s,!0);if(void 0!==a)for(var d=t.scripts[s],u=0;u<d.length;u++){var c=d[u],E=new Function(n,c.source+"\nreturn "+r+";").bind(a)(this,p,v,h);for(var l in E)void 0!==E[l]&&(void 0!==g[l]?g[l].push(E[l].bind(a)):console.warn("APP.Player: Event type not supported (",l,")"))}else console.warn("APP.Player: Script without object.",s)}e(g.init,arguments)},this.setCamera=function(e){h=e,h.aspect=this.width/this.height,h.updateProjectionMatrix(),w===!0&&(f=new THREE.PerspectiveCamera,f.projectionMatrix=h.projectionMatrix,h.add(f),E=new THREE.VRControls(f),l=new THREE.VREffect(p),WEBVR.isAvailable()===!0&&this.dom.appendChild(WEBVR.getButton(l)),WEBVR.isLatestAvailable()===!1&&this.dom.appendChild(WEBVR.getMessage()))},this.setScene=function(e){v=e},this.setSize=function(e,t){function n(e){e.alpha&&(E=new THREE.DeviceOrientationControls(h,!0),E.connect(),E.update(),window.removeEventListener("deviceorientation",n,!0))}this.width=e,this.height=t,h&&(h.aspect=this.width/this.height,h.updateProjectionMatrix()),p&&(p.setSize(e,t),l=new THREE.StereoEffect(p),window.addEventListener("deviceorientation",n,!0))};var L,y;this.play=function(){document.addEventListener("keydown",n),document.addEventListener("keyup",o),document.addEventListener("mousedown",i),document.addEventListener("mouseup",r),document.addEventListener("mousemove",s),document.addEventListener("touchstart",a),document.addEventListener("touchend",d),document.addEventListener("touchmove",u),e(g.start,arguments),y=requestAnimationFrame(t),L=performance.now()},this.stop=function(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",o),document.removeEventListener("mousedown",i),document.removeEventListener("mouseup",r),document.removeEventListener("mousemove",s),document.removeEventListener("touchstart",a),document.removeEventListener("touchend",d),document.removeEventListener("touchmove",u),e(g.stop,arguments),cancelAnimationFrame(y)},this.dispose=function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.firstChild);p.dispose(),h=void 0,v=void 0,p=void 0}}};